# AbyssCurse

一个为 Minecraft 服务器添加深渊诅咒机制的 PaperMC 插件，灵感来源于《来自深渊》(Made in Abyss)。玩家在深渊中上升时会触发致命的诅咒效果，带来紧张刺激的生存体验。

## 功能特性

### 核心机制

- **三层模式系统**：支持关闭模式、区域模式、全服模式
- **动态诅咒系统**：根据玩家累计上升高度触发诅咒
- **七层深渊诅咒**：从第一层到第七层，诅咒效果逐渐增强
- **生骸转换系统**：玩家在深层诅咒中可能转变为生骸（豁免者）
- **区域管理**：支持自定义深渊区域和豁免区
- **数据持久化**：玩家数据自动保存和加载

### 诅咒层级

1. **第一层 - 阿比斯之渊** (96 > y >= 85)：反胃
2. **第二层 - 诱惑之森** (85 > y >= 75)：反胃、饥饿、缓慢
3. **第三层 - 大断层** (75 > y >= 40)：以上所有 + 黑暗 + 随机音效
4. **第四层 - 巨人之杯** (40 > y >= 0)：以上所有 + 霉运 + 挖掘疲劳 + 虚弱
5. **第五层 - 亡骸之海** (0 > y >= -8)：以上所有 + 失明 + 中毒
6. **第六层 - 来无还之都** (-8 > y >= -28)：以上所有 + 寄生 + 凋零，可能转变为生骸
7. **第七层 - 最终极之涡** (-28 > y >= -64)：以上所有 + 瞬间伤害

### 生骸系统

- 玩家暴露在第六层及以下诅咒中时，每分钟都有概率转变为生骸
- 转换概率随时间指数增长，10分钟时达到最大值50%
- 生骸类型：幸运生骸（LUCKY）或悲惨生骸（SAD）
- 生骸不受诅咒影响，成为豁免者

## 安装要求

- **服务器**：PaperMC 1.21 或更高版本
- **Java**：Java 17 或更高版本
- **权限**：服务器管理员权限（用于配置）

## 安装步骤

1. 下载最新版本的 `AbyssCurse-1.0.0.jar`
2. 将文件放入服务器的 `plugins` 目录
3. 重启服务器
4. 编辑 `plugins/AbyssCurse/config.yml` 进行配置
5. 使用 `/abysscurse mode` 命令设置插件模式

## 配置说明

### 插件模式

插件支持三种运行模式：

- **OFF**：关闭模式，插件不生效
- **ABYSS**：区域模式，仅在指定区域内生效
- **WORLD**：全服模式，整个主世界都视为深渊

### 配置文件

主要配置文件位于 `plugins/AbyssCurse/config.yml`，包含以下设置：

- 深渊区域中心坐标和半径
- 豁免区列表
- 豁免者（生骸）列表
- 调试模式开关

## 管理员命令

所有命令都需要 `abysscurse.admin` 权限（默认 OP 拥有）。

### 主命令

```
/abysscurse
/abysscurse help
```
或使用别名：
```
/ac
/abyss
```

显示命令帮助信息。

---

### 模式切换

```
/abysscurse mode <off|abyss|world> [centerX] [centerY] [centerZ] [radius]
```

切换插件运行模式。

**参数说明：**
- `off`：关闭插件
- `abyss`：区域模式，需要指定区域参数
- `world`：全服模式

**区域模式参数：**
- `centerX`：深渊中心 X 坐标（任意方块坐标）
- `centerY`：深渊中心 Y 坐标（任意方块坐标）
- `centerZ`：深渊中心 Z 坐标（任意方块坐标）
- `radius`：深渊半径（区块数，使用切比雪夫距离）

**示例：**
```
/abysscurse mode off
/abysscurse mode world
/abysscurse mode abyss 0 64 0 10
```

---

### 重载配置

```
/abysscurse reload
```

重载插件配置文件，应用新的配置设置。

---

### 查看信息

```
/abysscurse info
```

查看插件当前状态信息，包括：
- 当前运行模式
- 深渊区域配置（如果使用区域模式）
- 插件版本

---

### 调试命令

```
/abysscurse debug <on|off|toggle|info|global> [on|off]
```

控制调试模式，用于排查问题。

**子命令说明：**
- `on`：开启玩家调试模式（仅玩家可用）
- `off`：关闭玩家调试模式（仅玩家可用）
- `toggle`：切换玩家调试模式（仅玩家可用）
- `info`：显示玩家调试信息（仅玩家可用）
- `global <on|off>`：控制全局调试模式（管理员可用）

**示例：**
```
/abysscurse debug on
/abysscurse debug toggle
/abysscurse debug global on
```

---

### 生骸管理

```
/abysscurse narehate <set|remove|check> <player>
```

管理玩家的生骸状态。

**子命令说明：**
- `set <player>`：将指定玩家设置为生骸
  - 随机分配生骸类型（LUCKY 或 SAD）
  - 播放不死图腾特效
  - 自动添加到豁免者列表
- `remove <player>`：移除指定玩家的生骸状态
  - 清除生骸类型
  - 从豁免者列表移除
- `check <player>`：查看指定玩家的生骸状态
  - 显示是否为生骸
  - 显示生骸类型（如果存在）

**示例：**
```
/abysscurse narehate set Steve
/abysscurse narehate remove Steve
/abysscurse narehate check Steve
```

**注意：**
- 支持在线和离线玩家
- 设置生骸时会自动播放不死图腾粒子效果和音效
- 生骸自动获得诅咒豁免

---

## 权限说明

### 权限节点

- `abysscurse.admin`：管理员权限
  - 允许使用所有管理员命令
  - 默认：OP
- `abysscurse.*`：所有权限
  - 包含所有子权限
  - 默认：OP

### 权限配置示例

在权限插件（如 LuckPerms）中配置：

```
/lp group admin permission set abysscurse.admin true
```

## 工作机制

### 累计上升高度

- 插件每 0.5 秒（10 tick）检查一次玩家 Y 坐标变化
- 上升时累计上升高度增加
- 下降时累计上升高度减少
- 累计上升高度达到 2 米时触发诅咒
- 累计上升记录在 20 分钟后自动过期

### 诅咒触发

- 触发条件：累计上升高度 >= 2 米
- 诅咒层级：根据触发时的安全高度确定
- 持续时间：根据诅咒臂动态计算（10分钟 * (半径 - 诅咒臂) / 半径）
- 诅咒效果：根据层级施加不同的负面效果

### 生骸转换

- 检查条件：玩家具有凋零效果（第六层及以下）且在深渊范围内
- 检查频率：每分钟检查一次
- 转换概率：指数型增长，10分钟时达到50%
- 转换效果：播放不死图腾粒子效果和音效

## 数据存储

- 玩家数据存储在 `plugins/AbyssCurse/players/` 目录
- 每个玩家一个 YAML 文件（UUID.yml）
- 数据包括：安全高度、累计上升高度、诅咒状态、生骸状态等
- 数据每 5 分钟自动保存一次

## 故障排除

### 常见问题

**Q: 诅咒没有触发？**
- 检查插件模式是否为 `off`
- 确认玩家在深渊区域内
- 检查玩家是否在豁免区或为豁免者
- 使用 `/abysscurse debug info` 查看调试信息

**Q: 生骸转换不生效？**
- 确认玩家具有凋零效果（第六层或第七层诅咒）
- 确认玩家在深渊范围内
- 检查玩家是否已经是生骸

**Q: 配置不生效？**
- 使用 `/abysscurse reload` 重载配置
- 检查配置文件格式是否正确
- 查看服务器日志中的错误信息

## 开发信息

- **版本**：1.0.0
- **API 版本**：1.21
- **作者**：KaleidScoper
- **许可证**：查看 LICENSE 文件

## 更新日志

### 1.0.0
- 初始版本发布
- 实现三层模式系统
- 实现七层诅咒系统
- 实现生骸转换系统
- 实现区域管理和豁免系统
- 实现数据持久化

## 贡献

欢迎提交 Issue 和 Pull Request！

## 许可证

查看项目根目录的 LICENSE 文件了解详情。
